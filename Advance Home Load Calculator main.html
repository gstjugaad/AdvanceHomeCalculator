<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Home Loan Calculator - होम लोन कैलकुलेटर</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning-gradient: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            --danger-gradient: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            --dark-bg: #0f0f23;
            --card-bg: rgba(255, 255, 255, 0.95);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --text-primary: #2d3436;
            --text-secondary: #636e72;
            --border-radius: 20px;
            --shadow: 0 20px 40px rgba(0,0,0,0.1);
            --glow: 0 0 30px rgba(102, 126, 234, 0.3);
        }
        
        body {
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
            background: var(--dark-bg);
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            animation: slideUp 0.8s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .header {
            position: relative;
            background: var(--primary-gradient);
            color: white;
            padding: 40px;
            text-align: center;
            overflow: hidden;
        }
        
        .header h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: 800;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #fff, #e0e6ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .company-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 30px;
            padding: 12px 20px;
            animation: float 3s ease-in-out infinite;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            padding: 40px;
        }
        
        .input-section, .results-section {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 25px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-group {
            margin-bottom: 25px;
            position: relative;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.95rem;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 15px;
            font-size: 16px;
            font-weight: 500;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }
        
        .btn {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 18px 35px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 15px;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        
        .result-card {
            background: var(--success-gradient);
            color: white;
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        
        .result-card .amount {
            font-size: 2.2rem;
            font-weight: 900;
        }
        
        .advanced-section {
            background: var(--glass-bg);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-top: 25px;
            padding: 25px;
            border-radius: var(--border-radius);
        }
        
        .feature-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }
        
        .tab-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            background: rgba(102, 126, 234, 0.1);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        
        .tab-btn.active {
            background: var(--primary-gradient);
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .prepayment-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .prepayment-type {
            padding: 15px;
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .prepayment-type.active {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }
        
        .chart-container, .emi-schedule, .analysis-section {
            grid-column: 1 / -1;
            background: var(--card-bg);
            padding: 30px;
            border-radius: var(--border-radius);
            margin-top: 25px;
        }
        
        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .schedule-table th {
            background: var(--primary-gradient);
            color: white;
            padding: 12px;
            text-align: center;
        }
        
        .schedule-table td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        
        .table-container {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .comparison-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 25px;
        }
        
        .comparison-card {
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            color: white;
        }
        
        .savings-highlight {
            background: var(--warning-gradient);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
        }
        
        .smart-suggestions {
            background: var(--danger-gradient);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .suggestion-item {
            margin: 10px 0;
            padding: 12px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
        }
        
        .export-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .export-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            color: white;
        }
        
        .export-pdf {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }
        
        .export-excel {
            background: linear-gradient(135deg, #27ae60, #229954);
        }
        
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🏠 Advanced होम लोन कैलकुलेटर</h1>
            <p>AI-Powered Financial Planning with Advanced Analytics</p>
            <div class="company-badge">
                <div class="badge-content">
                    <span>🚀</span>
                    <span>Made by <strong>Taurus Infotech</strong></span>
                </div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="input-section">
                <h2 class="section-title">📊 लोन और आय की जानकारी</h2>
                
                <div class="input-group">
                    <label for="loanAmount">लोन की राशि (₹)</label>
                    <input type="number" id="loanAmount" value="2500000" placeholder="25,00,000">
                </div>
                
                <div class="input-group">
                    <label for="interestRate">ब्याज दर (% प्रति वर्ष)</label>
                    <input type="number" id="interestRate" value="8.5" step="0.1" placeholder="8.5">
                </div>
                
                <div class="input-group">
                    <label for="loanTenure">लोन की अवधि (वर्ष)</label>
                    <input type="number" id="loanTenure" value="20" placeholder="20">
                </div>
                
                <div class="input-group">
                    <label for="monthlyIncome">मासिक आय (₹)</label>
                    <input type="number" id="monthlyIncome" value="100000" placeholder="1,00,000">
                </div>
                
                <div class="input-group">
                    <label for="annualIncrease">वार्षिक आय वृद्धि (%)</label>
                    <input type="number" id="annualIncrease" value="8" placeholder="8">
                </div>
                
                <div class="advanced-section">
                    <h3 style="margin-bottom: 20px; color: #667eea;">💰 Prepayment Strategy</h3>
                    
                    <div class="input-group">
                        <label for="extraEmi">अतिरिक्त EMI (₹ प्रति माह)</label>
                        <input type="number" id="extraEmi" value="0" placeholder="5000">
                    </div>
                    
                    <div class="prepayment-options">
                        <div class="prepayment-type active" onclick="selectPrepaymentType('yearly')">
                            <strong>वार्षिक Prepayment</strong>
                            <p>हर साल एक बार</p>
                        </div>
                        <div class="prepayment-type" onclick="selectPrepaymentType('onetime')">
                            <strong>One-time Prepayment</strong>
                            <p>एक बार में</p>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label for="prepaymentAmount">Prepayment राशि (₹)</label>
                        <input type="number" id="prepaymentAmount" value="0" placeholder="100000">
                    </div>
                    
                    <div class="input-group" id="prepaymentYearGroup">
                        <label for="prepaymentYear">Prepayment शुरू करने का साल</label>
                        <select id="prepaymentYear">
                            <option value="1">1st Year</option>
                            <option value="2" selected>2nd Year</option>
                            <option value="3">3rd Year</option>
                            <option value="4">4th Year</option>
                            <option value="5">5th Year</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn" onclick="calculateLoan()">🔍 Calculate & Analyze</button>
            </div>
            
            <div class="results-section">
                <h2 class="section-title">📈 Results & Analytics</h2>
                
                <div class="result-card">
                    <h3>Monthly EMI</h3>
                    <div class="amount" id="monthlyEmi">₹0</div>
                </div>
                
                <div class="result-card" style="background: var(--secondary-gradient);">
                    <h3>Total Payment</h3>
                    <div class="amount" id="totalPayment">₹0</div>
                </div>
                
                <div class="result-card" style="background: var(--danger-gradient);">
                    <h3>Total Interest</h3>
                    <div class="amount" id="totalInterest">₹0</div>
                </div>
                
                <div class="result-card">
                    <h3>EMI/Income Ratio</h3>
                    <div class="amount" id="emiRatio">0%</div>
                </div>
                
                <div class="comparison-cards" id="comparisonCards" style="display: none;">
                    <div class="comparison-card" style="background: linear-gradient(135deg, #ff7675, #fd79a8);">
                        <h4>Without Extra Payments</h4>
                        <p>Duration: <span id="normalTime"></span></p>
                        <p>Interest: <span id="normalInterest"></span></p>
                    </div>
                    <div class="comparison-card" style="background: linear-gradient(135deg, #00b894, #00cec9);">
                        <h4>With Extra Payments</h4>
                        <p>Duration: <span id="extraTime"></span></p>
                        <p>Interest: <span id="extraInterest"></span></p>
                    </div>
                </div>
                
                <div class="savings-highlight" id="savingsHighlight" style="display: none;">
                    <h3>💰 Your Savings</h3>
                    <p>Time Saved: <span id="timeSaved"></span></p>
                    <p>Money Saved: <span id="moneySaved"></span></p>
                </div>
                
                <div class="smart-suggestions" id="smartSuggestions" style="display: none;">
                    <h4>🤖 AI Recommendations</h4>
                    <div id="suggestionsList"></div>
                </div>
                
                <div class="export-buttons">
                    <button class="export-btn export-pdf" onclick="exportToPDF()">📄 Export PDF</button>
                    <button class="export-btn export-excel" onclick="exportToExcel()">📊 Export Excel</button>
                </div>
            </div>
        </div>
        
        <div class="chart-container">
            <h2 class="section-title">📊 Advanced Analytics Dashboard</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <div>
                    <h3 style="margin-bottom: 15px;">Principal vs Interest Over Time</h3>
                    <canvas id="loanChart" width="400" height="300"></canvas>
                </div>
                <div>
                    <h3 style="margin-bottom: 15px;">Payment Distribution</h3>
                    <canvas id="pieChart" width="400" height="300"></canvas>
                </div>
            </div>
        </div>
        
        <div class="emi-schedule">
            <h2 class="section-title">📋 Complete EMI Schedule</h2>
            <div class="table-container">
                <table class="schedule-table" id="scheduleTable">
                    <thead>
                        <tr>
                            <th>Year</th>
                            <th>Month</th>
                            <th>EMI</th>
                            <th>Principal</th>
                            <th>Interest</th>
                            <th>Extra Payment</th>
                            <th>Balance</th>
                            <th>Income</th>
                            <th>EMI/Income</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Initialize jsPDF
        const { jsPDF } = window.jspdf;
        
        let loanChart = null;
        let pieChart = null;
        let prepaymentType = 'yearly';
        
        function formatCurrency(amount) {
            return new Intl.NumberFormat('hi-IN', {
                style: 'currency',
                currency: 'INR',
                maximumFractionDigits: 0
            }).format(amount);
        }
        
        function calculateEMI(principal, rate, tenure) {
            const monthlyRate = rate / (12 * 100);
            const months = tenure * 12;
            const emi = (principal * monthlyRate * Math.pow(1 + monthlyRate, months)) / 
                       (Math.pow(1 + monthlyRate, months) - 1);
            return emi;
        }
        
        function selectPrepaymentType(type) {
            prepaymentType = type;
            document.querySelectorAll('.prepayment-type').forEach(el => el.classList.remove('active'));
            event.target.closest('.prepayment-type').classList.add('active');
            
            if (type === 'yearly') {
                document.getElementById('prepaymentYearGroup').style.display = 'block';
                document.getElementById('prepaymentMonthGroup').style.display = 'none';
            } else {
                document.getElementById('prepaymentYearGroup').style.display = 'none';
                document.getElementById('prepaymentMonthGroup').style.display = 'block';
            }
        }
        
        function calculateLoan() {
            try {
                const loanAmount = parseFloat(document.getElementById('loanAmount').value) || 0;
                const interestRate = parseFloat(document.getElementById('interestRate').value) || 0;
                const loanTenure = parseFloat(document.getElementById('loanTenure').value) || 0;
                const extraEmi = parseFloat(document.getElementById('extraEmi').value) || 0;
                const prepaymentAmount = parseFloat(document.getElementById('prepaymentAmount').value) || 0;
                const prepaymentYear = parseInt(document.getElementById('prepaymentYear').value) || 2;
                const monthlyIncome = parseFloat(document.getElementById('monthlyIncome').value) || 0;
                const annualIncrease = parseFloat(document.getElementById('annualIncrease').value) || 0;

                const monthlyRate = interestRate / (12 * 100);
                const regularEmi = calculateEMI(loanAmount, interestRate, loanTenure);

                // Normal calculation
                const normalMonths = loanTenure * 12;
                const normalTotalPayment = regularEmi * normalMonths;
                const normalTotalInterest = normalTotalPayment - loanAmount;
                
                // Advanced calculation
                let balance = loanAmount;
                let month = 1;
                let totalInterestPaid = 0;
                let totalPrincipalPaid = 0;
                let scheduleData = [];
                let chartLabels = [];
                let principalData = [];
                let interestData = [];
                let currentIncome = monthlyIncome;
                let annualIncomeIncrease = 1 + (annualIncrease / 100);
                
                while (balance > 0 && month <= 600) {
                    // Calculate income for this month (increase annually)
                    if (month % 12 === 1) {
                        currentIncome = monthlyIncome * Math.pow(annualIncomeIncrease, Math.floor((month-1)/12));
                    }
                    
                    const interestPayment = balance * monthlyRate;
                    let principalPayment = regularEmi - interestPayment;
                    let extraPayment = 0;
                    
                    if (extraEmi > 0) {
                        extraPayment += extraEmi;
                    }
                    
                    if (prepaymentAmount > 0) {
                        if (prepaymentType === 'yearly') {
                            const yearOfLoan = Math.ceil(month / 12);
                            if (yearOfLoan >= prepaymentYear && month % 12 === 0) {
                                extraPayment += prepaymentAmount;
                            }
                        }
                    }
                    
                    if (principalPayment + extraPayment > balance) {
                        extraPayment = balance - principalPayment;
                        if (extraPayment < 0) {
                            principalPayment = balance;
                            extraPayment = 0;
                        }
                    }
                    
                    balance -= (principalPayment + extraPayment);
                    totalInterestPaid += interestPayment;
                    totalPrincipalPaid += (principalPayment + extraPayment);
                    
                    const emiRatio = (regularEmi / currentIncome * 100).toFixed(1);
                    
                    scheduleData.push({
                        year: Math.ceil(month / 12),
                        month: month,
                        emi: regularEmi,
                        principal: principalPayment,
                        interest: interestPayment,
                        extraPayment: extraPayment,
                        balance: Math.max(0, balance),
                        income: currentIncome,
                        emiRatio: emiRatio
                    });
                    
                    if (month % 6 === 0 || balance <= 0) {
                        chartLabels.push(`Year ${Math.ceil(month/12)}`);
                        principalData.push(totalPrincipalPaid);
                        interestData.push(totalInterestPaid);
                    }
                    
                    month++;
                    if (balance <= 1) break;
                }
                
                const actualMonths = month - 1;
                const actualTotalPayment = loanAmount + totalInterestPaid;
                
                // Update results
                document.getElementById('monthlyEmi').textContent = formatCurrency(regularEmi);
                document.getElementById('totalPayment').textContent = formatCurrency(actualTotalPayment);
                document.getElementById('totalInterest').textContent = formatCurrency(totalInterestPaid);
                
                // Calculate EMI to Income ratio
                const initialEmiRatio = (regularEmi / monthlyIncome * 100).toFixed(1);
                document.getElementById('emiRatio').textContent = initialEmiRatio + '%';
                
                // Show comparison if extra payments
                if (extraEmi > 0 || prepaymentAmount > 0) {
                    document.getElementById('comparisonCards').style.display = 'grid';
                    document.getElementById('savingsHighlight').style.display = 'block';
                    
                    document.getElementById('normalTime').textContent = `${Math.floor(normalMonths/12)}y ${normalMonths%12}m`;
                    document.getElementById('normalInterest').textContent = formatCurrency(normalTotalInterest);
                    document.getElementById('extraTime').textContent = `${Math.floor(actualMonths/12)}y ${actualMonths%12}m`;
                    document.getElementById('extraInterest').textContent = formatCurrency(totalInterestPaid);
                    
                    const timeSaved = normalMonths - actualMonths;
                    const moneySaved = normalTotalInterest - totalInterestPaid;
                    
                    document.getElementById('timeSaved').textContent = `${Math.floor(timeSaved/12)}y ${timeSaved%12}m`;
                    document.getElementById('moneySaved').textContent = formatCurrency(moneySaved);
                }
                
                // Generate smart suggestions
                const suggestions = [
                    `Initial EMI/Income Ratio: ${initialEmiRatio}%`,
                    `Consider increasing EMI by 10% annually to reduce loan tenure`,
                    `Make lump sum payments when you receive bonuses or increments`,
                    `Review loan terms after 5 years for possible refinancing`
                ];
                
                document.getElementById('suggestionsList').innerHTML = suggestions.map(s => 
                    `<div class="suggestion-item">${s}</div>`
                ).join('');
                document.getElementById('smartSuggestions').style.display = 'block';
                
                // Update charts
                updateCharts(chartLabels, principalData, interestData, loanAmount, totalInterestPaid);
                
                // Update schedule table
                updateScheduleTable(scheduleData);
                
            } catch (error) {
                console.error("Calculation error:", error);
                alert("An error occurred during calculation. Please check your inputs.");
            }
        }
        
        function updateCharts(labels, principalData, interestData, loanAmount, totalInterest) {
            const ctx = document.getElementById('loanChart').getContext('2d');
            
            if (loanChart) {
                loanChart.destroy();
            }
            
            loanChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Principal Paid',
                            data: principalData,
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            fill: true
                        },
                        {
                            label: 'Interest Paid',
                            data: interestData,
                            borderColor: '#ff6b6b',
                            backgroundColor: 'rgba(255, 107, 107, 0.1)',
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Payment Progress Over Time'
                        }
                    }
                }
            });
            
            const pieCtx = document.getElementById('pieChart').getContext('2d');
            
            if (pieChart) {
                pieChart.destroy();
            }
            
            pieChart = new Chart(pieCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Principal', 'Interest'],
                    datasets: [{
                        data: [loanAmount, totalInterest],
                        backgroundColor: ['#667eea', '#ff6b6b']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Total Payment Breakdown'
                        }
                    }
                }
            });
        }
        
        function updateScheduleTable(scheduleData) {
            const tbody = document.querySelector('#scheduleTable tbody');
            tbody.innerHTML = '';
            
            // Show every month for first year, then every 6 months
            const filteredData = scheduleData.filter((row, index) => 
                row.month <= 12 || row.month % 6 === 0 || row.balance <= 1000
            );
            
            filteredData.forEach(row => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${row.year}</td>
                    <td>${row.month}</td>
                    <td>${formatCurrency(row.emi)}</td>
                    <td>${formatCurrency(row.principal)}</td>
                    <td>${formatCurrency(row.interest)}</td>
                    <td>${formatCurrency(row.extraPayment)}</td>
                    <td>${formatCurrency(row.balance)}</td>
                    <td>${formatCurrency(row.income)}</td>
                    <td>${row.emiRatio}%</td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        function exportToPDF() {
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '⏳ Generating PDF...';
            btn.disabled = true;
            
            const element = document.querySelector('.container');
            const options = {
                scale: 2,
                useCORS: true,
                allowTaint: true
            };
            
            html2canvas(element, options).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm'
                });
                
                const imgWidth = 210;
                const pageHeight = 295;
                const imgHeight = canvas.height * imgWidth / canvas.width;
                let heightLeft = imgHeight;
                let position = 0;
                
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                pdf.save('Home_Loan_Analysis.pdf');
                btn.textContent = originalText;
                btn.disabled = false;
            }).catch(error => {
                console.error('PDF generation error:', error);
                alert('Error generating PDF. Please try again.');
                btn.textContent = originalText;
                btn.disabled = false;
            });
        }
        
        function exportToExcel() {
            const table = document.getElementById('scheduleTable');
            let csv = [];
            
            // Add headers
            const headers = [];
            table.querySelectorAll('thead th').forEach(th => {
                headers.push(th.textContent);
            });
            csv.push(headers.join(','));
            
            // Add rows
            table.querySelectorAll('tbody tr').forEach(tr => {
                const row = [];
                tr.querySelectorAll('td').forEach(td => {
                    row.push(td.textContent.replace(/₹/g, '').replace(/,/g, ''));
                });
                csv.push(row.join(','));
            });
            
            // Download CSV
            const csvContent = csv.join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'loan_schedule.csv';
            link.click();
            
            // Show success message
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '✅ Downloaded!';
            setTimeout(() => {
                btn.textContent = originalText;
            }, 2000);
        }
        
        // Initialize calculator on page load
        document.addEventListener('DOMContentLoaded', function() {
            calculateLoan();
            
            // Add input event listeners for auto-calculation
            const inputs = [
                'loanAmount', 'interestRate', 'loanTenure', 'extraEmi',
                'prepaymentAmount', 'prepaymentYear', 'monthlyIncome', 'annualIncrease'
            ];
            
            inputs.forEach(id => {
                document.getElementById(id).addEventListener('input', function() {
                    clearTimeout(this.timer);
                    this.timer = setTimeout(calculateLoan, 500);
                });
            });
        });
    </script>
</body>
</html>